#context hyperreals #( namespace implicit by file name )

# https://en.wikipedia.org/wiki/Hyperreal_number

#axioms
Îµ = epsilon # builtin!
Ï‰ = omega # := 1/Îµ theoretically but use different compute symbols

Ï‰ â‰ˆ âˆ
Îµ â‰ˆ 0

# âˆš-1=Ã¯ # this way round, because we extend the âˆš function!

1/Îµ = Ï‰
1/Ï‰ = Îµ
Îµ*Ï‰ = 1 # gauge consistency
#Îµ = Ï‰â»Â¹ # convenience definition
#1/0 = Ï‰
1/0 = âˆ
1/âˆ = 0
#Îµ*âˆ = âˆ ?
#âˆ/Ï‰ = âˆ ?
#r*âˆ = âˆ for r in â„
#Ï‰â¿ > r*Ï‰ for r in â„, n>1


# integral Îµ = 1
âˆ«Îµ = 1 # that is:
âˆ«(-âˆ,âˆ)(Îµ) = 1 # infinite line
âˆ«(-Ï‰,Ï‰)(Îµ) = 1 # -''-
âˆ«(-Îµ,Îµ)(Ï‰) = 1 # spike

âš ï¸ infinite sums of in the hyperreals don't really play the way one might expect:
âš ï¸ The hyperreal universe has its own kinds of sequences and series, which are no longer indexed by â„• but rather by âˆ—â„•, the nonstandard natural numbers. 

#derivatives
âˆ‚(x==0)(0) = Ï‰ # derivative of spike function  # âˆ‚(x==0)(y) = 0 for yâ‰ 0
âˆ‚(x>0)(Îµ)  = Ï‰ # derivative of step function   # âˆ‚(x>0 )(y) = 0 for yâ‰ Îµ

âˆ‚(x==0 and Ï‰)(0) = Ï‰Â² # second order spike

#ğ•€ infinitesimal numbers
ğ•€ = span field <Îµ, Ï‰>
â„âˆ—
â„â‹† = â„(Îµ, Ï‰)  # ordered field extension
â„â‹† = â„(Îµ)     # because Ï‰ := 1/Îµ 
â„â‹† = â„Ã—ğ•€   
â„âˆ— = â„â‹†

Unit Omega   # treat it externally! give automatic arithmetics see Unitful in Julia
Unit Epsilon # treat it externally too?
# 1 km + 1 s DimensionError ill defined but 1 + Îµ exactly what we want

class HyperReal is Number {
	# class â„â‹† 
	alias Hyper

# hyperreals â„â‹† are an ordered field extension of â„

	#Number omega alias om # omega â‰  0 makes the following irrelevant:
	# treat it externally!
	Number real alias real part, re, standard part, st, shadow, sh
	Number epsilon alias ep, eps # âš ï¸ todo unlike Complex numbers Îµ^2 â‰  Îµ ?

# transfer principle:  
# first-order statements about â„ are also valid in â„â‹†

	ğ‘*ğ‘ := 
	times(number) = Hyper(this.real*number,this.epsilon, this.omega)
	plus(number)  = Hyper(this.real+number,this.epsilon, this.omega) # â€¦

  a==b := a.omega==b.omega and a.real==b.real and a.epsilon==b.epsilon 

	ğ‘â‰ƒğ‘ := 
	    a.omega==b.omega==0 and a.real==b.real==0 and a.epsilon == b.epsilon or
	    a.omega==b.omega==0 and a.real==b.real or
	    a.omega==b.omega 

	ğ‘>ğ‘ := 
	    a.omega==b.omega==0 and a.real==b.real==0 and a.epsilon > b.epsilon or
	    a.omega==b.omega==0 and a.real>b.real or
	    a.omega>b.omega 

	ğ‘<ğ‘ := 
	    a.omega==b.omega==0 and a.real==b.real==0 and a.epsilon > b.epsilon or
	    a.omega==b.omega==0 and a.real>b.real or
	    a.omega>b.omega 

}



# external definition as in Julia
times(Ï‰,Îµ) = 1
times(Îµ,Ï‰) = 1
simplify(hyper y) = 
		Hyper(0, 0, y.omega) if y.omega
		Hyper(y.real, 0, 0)  eif y.real
		Hyper(0,y.epsilon,0) oif #otherwise

# todo: add Îµ Ï‰ as two special values / flags in wasp number representation f64 see Inf, NaN â€¦

times(number x,hyper y) = Hyper(x*y.real,x*y.epsilon, x*y.omega)
times(hyper x,hyper y) = Hyper(x.real*y.real,x.real*y.epsilon+y.real*x.epsilon, hyper.omega)
times(hyper x,Îµ) = Hyper(0, x.real, 0)
times(hyper x,Îµ) = Hyper(0, x.real, 0)

epsilon := Hyper(0,1,0)
omega := Hyper(0,0,1)

âš ï¸ free standing Îµ vs x.Îµ



# Applications

## Derivatives
"define the derivative algebraically"
operator âˆ‚ 
âˆ‚f(x)=(f(x+Îµ)-f(x))/Îµ
// e.g 
// f(x)=x^2 
// âˆ‚f(x)=((x+Îµ)^2)-x^2)/Îµ = (2xÎµ + Îµ^2)/Îµ = 2x + Îµ 

real derivative (f) = st(âˆ‚f) 

## Probabilities
"Traditional probability theory introduced zero-sets to handle cases such as:"
"Probability of hitting an exact number in the Uniform Distribution over an interval e.g. [0,1]"
P(x=y)=Îµ for y in [0,1] # classically "'0' but not impossible"

âš ï¸ different zero-sets can result in different (multiplier / exponent ) variants of Îµ

### Defining Uniform Distribution over [-âˆ,âˆ] aka â„ now possible?
"TODO: Probability of hitting an exact number in the interval [-âˆ,âˆ] aka â„ with Uniform Distribution"
P(x in [0,1])=Îµ or
P(x=y)=Îµ or 
P(x=y)=Îµáµš 

## Measures
"more generally than the above Probability values, we can allow Measure Theory to make use of HyperReal numbers"
âš ï¸ todo


# other
"replace limes with algebraic expressions"
e = lim(n=>âˆ) (1+1/n)^n
e = (1+1/Ï‰)^Ï‰ = (1+Îµ)^Ï‰


# desired theorem:
Îµ == 1 - 0.9Ì… # may or may not be true and is usually not of concern https://arxiv.org/abs/1007.3018
âš ï¸ the above statement strongly depends on exact meaning / notation 0.9Ì… vs 0.9Ì‚ vs .999â€¦ vs .999â€¦;â€¦999
indeed we just need proper definitions for
0.9Ì… = 0.9Ì‚ + Îµ = 1
likewise
1/3 = 0.333â€¦ + Îµ
# âˆ‘ğ‘–âˆˆâ„• 9/10^ğ‘– does not have a supremum and thus does not make sense in nonstandard analysis.
# academic questions, we are only interested in axiomatic algebraic Applications

