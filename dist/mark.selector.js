(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.MarkSelector=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({"/lib/mark.selector.js":[function(require,module,exports){const CSSselect=require("./css-select/index.js");function isTag(node){return typeof node==="object"&&node.constructor}function getParent(node){return node.parent()}function getChildren(node){return node[0]?node.contents():[]}const adapter={isTag:isTag,existsOne:function(test,elems){return elems.some(function(elem){return isTag(elem)?test(elem)||adapter.existsOne(test,getChildren(elem)):false})},getAttributeValue:function(elem,name){return elem[name]},getChildren:getChildren,getName:function(elem){return elem.constructor.name},getParent:getParent,getSiblings:function(node){var parent=getParent(node);return parent&&getChildren(parent)},hasAttrib:function(elem,name){return name in elem},findAll:function findAll(test,elems){var result=[];for(var elem of elems){if(!isTag(elem))continue;if(test(elem))result.push(elem);var childs=getChildren(elem);if(childs)result=result.concat(findAll(test,childs))}return result}};module.exports=function(elmt){return{find:function(query,options){try{return CSSselect(query,elmt,{xmlMode:options&&options.caseSensitive,adapter:adapter})}catch(error){console.error(error);return[]}},matches:function(query,options){try{return CSSselect.is(elmt,query,{xmlMode:options&&options.caseSensitive,adapter:adapter})}catch(error){console.error(error);return false}}}}},{"./css-select/index.js":5}],1:[function(require,module,exports){var falseFunc=require("boolbase").falseFunc;var reChars=/[-[\]{}()*+?.,\\^$|#\s]/g;function factory(adapter){var attributeRules={__proto__:null,equals:function(next,data){var name=data.name,value=data.value;if(data.ignoreCase){value=value.toLowerCase();return function equalsIC(elem){var attr=adapter.getAttributeValue(elem,name);return attr!=null&&attr.toLowerCase()===value&&next(elem)}}return function equals(elem){return adapter.getAttributeValue(elem,name)===value&&next(elem)}},hyphen:function(next,data){var name=data.name,value=data.value,len=value.length;if(data.ignoreCase){value=value.toLowerCase();return function hyphenIC(elem){var attr=adapter.getAttributeValue(elem,name);return attr!=null&&(attr.length===len||attr.charAt(len)==="-")&&attr.substr(0,len).toLowerCase()===value&&next(elem)}}return function hyphen(elem){var attr=adapter.getAttributeValue(elem,name);return attr!=null&&attr.substr(0,len)===value&&(attr.length===len||attr.charAt(len)==="-")&&next(elem)}},element:function(next,data){var name=data.name,value=data.value;if(/\s/.test(value)){return falseFunc}value=value.replace(reChars,"\\$&");var pattern="(?:^|\\s)"+value+"(?:$|\\s)",flags=data.ignoreCase?"i":"",regex=new RegExp(pattern,flags);return function element(elem){var attr=adapter.getAttributeValue(elem,name);return attr!=null&&regex.test(attr)&&next(elem)}},exists:function(next,data){var name=data.name;return function exists(elem){return adapter.hasAttrib(elem,name)&&next(elem)}},start:function(next,data){var name=data.name,value=data.value,len=value.length;if(len===0){return falseFunc}if(data.ignoreCase){value=value.toLowerCase();return function startIC(elem){var attr=adapter.getAttributeValue(elem,name);return attr!=null&&attr.substr(0,len).toLowerCase()===value&&next(elem)}}return function start(elem){var attr=adapter.getAttributeValue(elem,name);return attr!=null&&attr.substr(0,len)===value&&next(elem)}},end:function(next,data){var name=data.name,value=data.value,len=-value.length;if(len===0){return falseFunc}if(data.ignoreCase){value=value.toLowerCase();return function endIC(elem){var attr=adapter.getAttributeValue(elem,name);return attr!=null&&attr.substr(len).toLowerCase()===value&&next(elem)}}return function end(elem){var attr=adapter.getAttributeValue(elem,name);return attr!=null&&attr.substr(len)===value&&next(elem)}},any:function(next,data){var name=data.name,value=data.value;if(value===""){return falseFunc}if(data.ignoreCase){var regex=new RegExp(value.replace(reChars,"\\$&"),"i");return function anyIC(elem){var attr=adapter.getAttributeValue(elem,name);return attr!=null&&regex.test(attr)&&next(elem)}}return function any(elem){var attr=adapter.getAttributeValue(elem,name);return attr!=null&&attr.indexOf(value)>=0&&next(elem)}},not:function(next,data){var name=data.name,value=data.value;if(value===""){return function notEmpty(elem){return!!adapter.getAttributeValue(elem,name)&&next(elem)}}else if(data.ignoreCase){value=value.toLowerCase();return function notIC(elem){var attr=adapter.getAttributeValue(elem,name);return attr!=null&&attr.toLowerCase()!==value&&next(elem)}}return function not(elem){return adapter.getAttributeValue(elem,name)!==value&&next(elem)}}};return{compile:function(next,data,options){if(options&&options.strict&&(data.ignoreCase||data.action==="not"))throw new Error("Unsupported attribute selector");return attributeRules[data.action](next,data)},rules:attributeRules}}module.exports=factory},{boolbase:9}],2:[function(require,module,exports){module.exports=compileFactory;var parse=require("./css-what.js"),BaseFuncs=require("boolbase"),sortRules=require("./sort.js"),procedure=require("./procedure.json"),rulesFactory=require("./general.js"),pseudosFactory=require("./pseudos.js"),trueFunc=BaseFuncs.trueFunc,falseFunc=BaseFuncs.falseFunc;function compileFactory(adapter){var Pseudos=pseudosFactory(adapter),filters=Pseudos.filters,Rules=rulesFactory(adapter,Pseudos);function compile(selector,options,context){var next=compileUnsafe(selector,options,context);return wrap(next)}function wrap(next){return function base(elem){return adapter.isTag(elem)&&next(elem)}}function compileUnsafe(selector,options,context){var token=parse(selector,options);return compileToken(token,options,context)}function includesScopePseudo(t){return t.type==="pseudo"&&(t.name==="scope"||Array.isArray(t.data)&&t.data.some(function(data){return data.some(includesScopePseudo)}))}var DESCENDANT_TOKEN={type:"descendant"},FLEXIBLE_DESCENDANT_TOKEN={type:"_flexibleDescendant"},SCOPE_TOKEN={type:"pseudo",name:"scope"},PLACEHOLDER_ELEMENT={};function absolutize(token,context){var hasContext=!!context&&!!context.length&&context.every(function(e){return e===PLACEHOLDER_ELEMENT||!!adapter.getParent(e)});token.forEach(function(t){if(t.length>0&&isTraversal(t[0])&&t[0].type!=="descendant"){}else if(hasContext&&!includesScopePseudo(t)){t.unshift(DESCENDANT_TOKEN)}else{return}t.unshift(SCOPE_TOKEN)})}function compileToken(token,options,context){token=token.filter(function(t){return t.length>0});token.forEach(sortRules);var isArrayContext=Array.isArray(context);context=options&&options.context||context;if(context&&!isArrayContext)context=[context];absolutize(token,context);var shouldTestNextSiblings=false;var query=token.map(function(rules){if(rules[0]&&rules[1]&&rules[0].name==="scope"){var ruleType=rules[1].type;if(isArrayContext&&ruleType==="descendant")rules[1]=FLEXIBLE_DESCENDANT_TOKEN;else if(ruleType==="adjacent"||ruleType==="sibling")shouldTestNextSiblings=true}return compileRules(rules,options,context)}).reduce(reduceRules,falseFunc);query.shouldTestNextSiblings=shouldTestNextSiblings;return query}function isTraversal(t){return procedure[t.type]<0}function compileRules(rules,options,context){return rules.reduce(function(func,rule){if(func===falseFunc)return func;return Rules[rule.type](func,rule,options,context)},options&&options.rootFunc||trueFunc)}function reduceRules(a,b){if(b===falseFunc||a===trueFunc){return a}if(a===falseFunc||b===trueFunc){return b}return function combine(elem){return a(elem)||b(elem)}}function containsTraversal(t){return t.some(isTraversal)}filters.not=function(next,token,options,context){var opts={xmlMode:!!(options&&options.xmlMode),strict:!!(options&&options.strict)};if(opts.strict){if(token.length>1||token.some(containsTraversal)){throw new Error("complex selectors in :not aren't allowed in strict mode")}}var func=compileToken(token,opts,context);if(func===falseFunc)return next;if(func===trueFunc)return falseFunc;return function(elem){return!func(elem)&&next(elem)}};filters.has=function(next,token,options){var opts={xmlMode:!!(options&&options.xmlMode),strict:!!(options&&options.strict)};var context=token.some(containsTraversal)?[PLACEHOLDER_ELEMENT]:null;var func=compileToken(token,opts,context);if(func===falseFunc)return falseFunc;if(func===trueFunc){return function(elem){return adapter.getChildren(elem).some(adapter.isTag)&&next(elem)}}func=wrap(func);if(context){return function has(elem){return next(elem)&&(context[0]=elem,adapter.existsOne(func,adapter.getChildren(elem)))}}return function has(elem){return next(elem)&&adapter.existsOne(func,adapter.getChildren(elem))}};filters.matches=function(next,token,options,context){var opts={xmlMode:!!(options&&options.xmlMode),strict:!!(options&&options.strict),rootFunc:next};return compileToken(token,opts,context)};compile.compileToken=compileToken;compile.compileUnsafe=compileUnsafe;compile.Pseudos=Pseudos;return compile}},{"./css-what.js":3,"./general.js":4,"./procedure.json":6,"./pseudos.js":7,"./sort.js":8,boolbase:9}],3:[function(require,module,exports){"use strict";module.exports=parse;var re_name=/^(?:\\.|[\w\-\u00c0-\uFFFF])+/,re_escape=/\\([\da-f]{1,6}\s?|(\s)|.)/gi,re_attr=/^\s*((?:\\.|[\w\u00c0-\uFFFF\-])+)\s*(?:(\S?)=\s*(?:(['"])(.*?)\3|(#?(?:\\.|[\w\u00c0-\uFFFF\-])*)|)|)\s*(i)?\]/;var actionTypes={__proto__:null,undefined:"exists","":"equals","~":"element","^":"start",$:"end","*":"any","!":"not","|":"hyphen"};var simpleSelectors={__proto__:null,">":"child","<":"parent","~":"sibling","+":"adjacent"};var attribSelectors={__proto__:null,"#":["id","equals"],".":["class","element"]};var unpackPseudos={__proto__:null,has:true,not:true,matches:true};var stripQuotesFromPseudos={__proto__:null,contains:true,icontains:true};var quotes={__proto__:null,'"':true,"'":true};function funescape(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!==high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,high&1023|56320)}function unescapeCSS(str){return str.replace(re_escape,funescape)}function isWhitespace(c){return c===" "||c==="\n"||c==="\t"||c==="\f"||c==="\r"}function parse(selector,options){var subselects=[];selector=parseSelector(subselects,selector+"",options);if(selector!==""){throw new SyntaxError("Unmatched selector: "+selector)}return subselects}function parseSelector(subselects,selector,options){var tokens=[],sawWS=false,data,firstChar,name,quot;function getName(){var sub=selector.match(re_name)[0];selector=selector.substr(sub.length);return unescapeCSS(sub)}function stripWhitespace(start){while(isWhitespace(selector.charAt(start)))start++;selector=selector.substr(start)}stripWhitespace(0);while(selector!==""){firstChar=selector.charAt(0);if(isWhitespace(firstChar)){sawWS=true;stripWhitespace(1)}else if(firstChar in simpleSelectors){if(firstChar===">"&&selector.charAt(1)===">"){tokens.push({type:"descendant"});stripWhitespace(2)}else{tokens.push({type:simpleSelectors[firstChar]});stripWhitespace(1)}sawWS=false}else if(firstChar===","){if(tokens.length===0){throw new SyntaxError("empty sub-selector")}subselects.push(tokens);tokens=[];sawWS=false;stripWhitespace(1)}else{if(sawWS){if(tokens.length>0){tokens.push({type:"descendant"})}sawWS=false}if(firstChar==="*"){selector=selector.substr(1);tokens.push({type:"universal"})}else if(firstChar in attribSelectors){selector=selector.substr(1);tokens.push({type:"attribute",name:attribSelectors[firstChar][0],action:attribSelectors[firstChar][1],value:getName(),ignoreCase:false})}else if(firstChar==="["){selector=selector.substr(1);data=selector.match(re_attr);if(!data){throw new SyntaxError("Malformed attribute selector: "+selector)}selector=selector.substr(data[0].length);name=unescapeCSS(data[1]);if(!options||("lowerCaseAttributeNames"in options?options.lowerCaseAttributeNames:!options.xmlMode)){name=name.toLowerCase()}tokens.push({type:"attribute",name:name,action:actionTypes[data[2]],value:unescapeCSS(data[4]||data[5]||""),ignoreCase:!!data[6]})}else if(firstChar===":"){if(selector.charAt(1)===":"){selector=selector.substr(2);tokens.push({type:"pseudo-element",name:getName().toLowerCase()});continue}selector=selector.substr(1);name=getName().toLowerCase();data=null;if(selector.charAt(0)==="("){if(name in unpackPseudos){quot=selector.charAt(1);var quoted=quot in quotes;selector=selector.substr(quoted+1);data=[];selector=parseSelector(data,selector,options);if(quoted){if(selector.charAt(0)!==quot){throw new SyntaxError("unmatched quotes in :"+name)}else{selector=selector.substr(1)}}if(selector.charAt(0)!==")"){throw new SyntaxError("missing closing parenthesis in :"+name+" "+selector)}selector=selector.substr(1)}else{var pos=1,counter=1;for(;counter>0&&pos<selector.length;pos++){if(selector.charAt(pos)==="(")counter++;else if(selector.charAt(pos)===")")counter--}if(counter){throw new SyntaxError("parenthesis not matched")}data=selector.substr(1,pos-2);selector=selector.substr(pos);if(name in stripQuotesFromPseudos){quot=data.charAt(0);if(quot===data.slice(-1)&&quot in quotes){data=data.slice(1,-1)}data=unescapeCSS(data)}}}tokens.push({type:"pseudo",name:name,data:data})}else if(re_name.test(selector)){name=getName();if(!options||("lowerCaseTags"in options?options.lowerCaseTags:!options.xmlMode)){name=name.toLowerCase()}tokens.push({type:"tag",name:name})}else{if(tokens.length&&tokens[tokens.length-1].type==="descendant"){tokens.pop()}addToken(subselects,tokens);return selector}}}addToken(subselects,tokens);return selector}function addToken(subselects,tokens){if(subselects.length>0&&tokens.length===0){throw new SyntaxError("empty sub-selector")}subselects.push(tokens)}},{}],4:[function(require,module,exports){var attributeFactory=require("./attributes.js");function generalFactory(adapter,Pseudos){return{__proto__:null,attribute:attributeFactory(adapter).compile,pseudo:Pseudos.compile,tag:function(next,data){var name=data.name;return function tag(elem){return adapter.getName(elem)===name&&next(elem)}},descendant:function(next){return function descendant(elem){var found=false;while(!found&&(elem=adapter.getParent(elem))){found=next(elem)}return found}},_flexibleDescendant:function(next){return function descendant(elem){var found=next(elem);while(!found&&(elem=adapter.getParent(elem))){found=next(elem)}return found}},parent:function(next,data,options){if(options&&options.strict)throw new Error("Parent selector isn't part of CSS3");return function parent(elem){return adapter.getChildren(elem).some(test)};function test(elem){return adapter.isTag(elem)&&next(elem)}},child:function(next){return function child(elem){var parent=adapter.getParent(elem);return!!parent&&next(parent)}},sibling:function(next){return function sibling(elem){var siblings=adapter.getSiblings(elem);for(var i=0;i<siblings.length;i++){if(adapter.isTag(siblings[i])){if(siblings[i]===elem)break;if(next(siblings[i]))return true}}return false}},adjacent:function(next){return function adjacent(elem){var siblings=adapter.getSiblings(elem),lastElement;for(var i=0;i<siblings.length;i++){if(adapter.isTag(siblings[i])){if(siblings[i]===elem)break;lastElement=siblings[i]}}return!!lastElement&&next(lastElement)}},universal:function(next){return next}}}module.exports=generalFactory},{"./attributes.js":1}],5:[function(require,module,exports){"use strict";module.exports=CSSselect;var falseFunc=require("boolbase").falseFunc,compileFactory=require("./compile.js"),defaultCompile=compileFactory();function getSelectorFunc(searchFunc){return function select(query,elems,options){options=options||{};var compile=compileFactory(options.adapter);if(typeof query!=="function")query=compile.compileUnsafe(query,options,elems);if(query.shouldTestNextSiblings)elems=appendNextSiblings(options&&options.context||elems,options.adapter);if(!Array.isArray(elems))elems=options.adapter.getChildren(elems);else elems=options.adapter.removeSubsets(elems);return searchFunc(query,elems,options)}}function getNextSiblings(elem,adapter){var siblings=adapter.getSiblings(elem);if(!Array.isArray(siblings))return[];siblings=siblings.slice(0);while(siblings.shift()!==elem);return siblings}function appendNextSiblings(elems,adapter){if(!Array.isArray(elems))elems=[elems];var newElems=elems.slice(0);for(var i=0,len=elems.length;i<len;i++){var nextSiblings=getNextSiblings(newElems[i],adapter);newElems.push.apply(newElems,nextSiblings)}return newElems}var selectAll=getSelectorFunc(function selectAll(query,elems,options){return query===falseFunc||!elems||elems.length===0?[]:options.adapter.findAll(query,elems)});var selectOne=getSelectorFunc(function selectOne(query,elems,options){return query===falseFunc||!elems||elems.length===0?null:options.adapter.findOne(query,elems)});function is(elem,query,options){options=options||{};var compile=compileFactory(options.adapter);return(typeof query==="function"?query:compile(query,options))(elem)}function CSSselect(query,elems,options){return selectAll(query,elems,options)}CSSselect.compile=defaultCompile;CSSselect.filters=defaultCompile.Pseudos.filters;CSSselect.pseudos=defaultCompile.Pseudos.pseudos;CSSselect.selectAll=selectAll;CSSselect.selectOne=selectOne;CSSselect.is=is},{"./compile.js":2,boolbase:9}],6:[function(require,module,exports){module.exports={universal:50,tag:30,attribute:1,pseudo:0,descendant:-1,child:-1,parent:-1,sibling:-1,adjacent:-1}},{}],7:[function(require,module,exports){var getNCheck=require("nth-check"),BaseFuncs=require("boolbase"),attributesFactory=require("./attributes.js"),trueFunc=BaseFuncs.trueFunc,falseFunc=BaseFuncs.falseFunc;function filtersFactory(adapter){var attributes=attributesFactory(adapter),checkAttrib=attributes.rules.equals;function equals(a,b){if(typeof adapter.equals==="function")return adapter.equals(a,b);return a===b}function getAttribFunc(name,value){var data={name:name,value:value};return function attribFunc(next){return checkAttrib(next,data)}}function getChildFunc(next){return function(elem){return!!adapter.getParent(elem)&&next(elem)}}var filters={contains:function(next,text){return function contains(elem){return next(elem)&&adapter.getText(elem).indexOf(text)>=0}},icontains:function(next,text){var itext=text.toLowerCase();return function icontains(elem){return next(elem)&&adapter.getText(elem).toLowerCase().indexOf(itext)>=0}},"nth-child":function(next,rule){var func=getNCheck(rule);if(func===falseFunc)return func;if(func===trueFunc)return getChildFunc(next);return function nthChild(elem){var siblings=adapter.getSiblings(elem);for(var i=0,pos=0;i<siblings.length;i++){if(adapter.isTag(siblings[i])){if(siblings[i]===elem)break;else pos++}}return func(pos)&&next(elem)}},"nth-last-child":function(next,rule){var func=getNCheck(rule);if(func===falseFunc)return func;if(func===trueFunc)return getChildFunc(next);return function nthLastChild(elem){var siblings=adapter.getSiblings(elem);for(var pos=0,i=siblings.length-1;i>=0;i--){if(adapter.isTag(siblings[i])){if(siblings[i]===elem)break;else pos++}}return func(pos)&&next(elem)}},"nth-of-type":function(next,rule){var func=getNCheck(rule);if(func===falseFunc)return func;if(func===trueFunc)return getChildFunc(next);return function nthOfType(elem){var siblings=adapter.getSiblings(elem);for(var pos=0,i=0;i<siblings.length;i++){if(adapter.isTag(siblings[i])){if(siblings[i]===elem)break;if(adapter.getName(siblings[i])===adapter.getName(elem))pos++}}return func(pos)&&next(elem)}},"nth-last-of-type":function(next,rule){var func=getNCheck(rule);if(func===falseFunc)return func;if(func===trueFunc)return getChildFunc(next);return function nthLastOfType(elem){var siblings=adapter.getSiblings(elem);for(var pos=0,i=siblings.length-1;i>=0;i--){if(adapter.isTag(siblings[i])){if(siblings[i]===elem)break;if(adapter.getName(siblings[i])===adapter.getName(elem))pos++}}return func(pos)&&next(elem)}},root:function(next){return function(elem){return!adapter.getParent(elem)&&next(elem)}},scope:function(next,rule,options,context){if(!context||context.length===0){return filters.root(next)}if(context.length===1){return function(elem){return equals(context[0],elem)&&next(elem)}}return function(elem){return context.indexOf(elem)>=0&&next(elem)}}};return filters}function pseudosFactory(adapter){function getFirstElement(elems){for(var i=0;elems&&i<elems.length;i++){if(adapter.isTag(elems[i]))return elems[i]}}var pseudos={empty:function(elem){return!adapter.getChildren(elem).some(function(elem){return adapter.isTag(elem)||elem.type==="text"})},"first-child":function(elem){return getFirstElement(adapter.getSiblings(elem))===elem},"last-child":function(elem){var siblings=adapter.getSiblings(elem);for(var i=siblings.length-1;i>=0;i--){if(siblings[i]===elem)return true;if(adapter.isTag(siblings[i]))break}return false},"first-of-type":function(elem){var siblings=adapter.getSiblings(elem);for(var i=0;i<siblings.length;i++){if(adapter.isTag(siblings[i])){if(siblings[i]===elem)return true;if(adapter.getName(siblings[i])===adapter.getName(elem))break}}return false},"last-of-type":function(elem){var siblings=adapter.getSiblings(elem);for(var i=siblings.length-1;i>=0;i--){if(adapter.isTag(siblings[i])){if(siblings[i]===elem)return true;if(adapter.getName(siblings[i])===adapter.getName(elem))break}}return false},"only-of-type":function(elem){var siblings=adapter.getSiblings(elem);for(var i=0,j=siblings.length;i<j;i++){if(adapter.isTag(siblings[i])){if(siblings[i]===elem)continue;if(adapter.getName(siblings[i])===adapter.getName(elem))return false}}return true},"only-child":function(elem){var siblings=adapter.getSiblings(elem);for(var i=0;i<siblings.length;i++){if(adapter.isTag(siblings[i])&&siblings[i]!==elem)return false}return true}};return pseudos}function verifyArgs(func,name,subselect){if(subselect===null){if(func.length>1&&name!=="scope"){throw new Error("pseudo-selector :"+name+" requires an argument")}}else{if(func.length===1){throw new Error("pseudo-selector :"+name+" doesn't have any arguments")}}}var re_CSS3=/^(?:(?:nth|last|first|only)-(?:child|of-type)|root|empty|(?:en|dis)abled|checked|not)$/;function factory(adapter){var pseudos=pseudosFactory(adapter);var filters=filtersFactory(adapter);return{compile:function(next,data,options,context){var name=data.name,subselect=data.data;if(options&&options.strict&&!re_CSS3.test(name)){throw new Error(":"+name+" isn't part of CSS3")}if(typeof filters[name]==="function"){verifyArgs(filters[name],name,subselect);return filters[name](next,subselect,options,context)}else if(typeof pseudos[name]==="function"){var func=pseudos[name];verifyArgs(func,name,subselect);if(next===trueFunc)return func;return function pseudoArgs(elem){return func(elem,subselect)&&next(elem)}}else{throw new Error("unmatched pseudo-class :"+name)}},filters:filters,pseudos:pseudos}}module.exports=factory},{"./attributes.js":1,boolbase:9,"nth-check":11}],8:[function(require,module,exports){module.exports=sortByProcedure;var procedure=require("./procedure.json");var attributes={__proto__:null,exists:10,equals:8,not:7,start:6,end:6,any:5,hyphen:4,element:4};function sortByProcedure(arr){var procs=arr.map(getProcedure);for(var i=1;i<arr.length;i++){var procNew=procs[i];if(procNew<0)continue;for(var j=i-1;j>=0&&procNew<procs[j];j--){var token=arr[j+1];arr[j+1]=arr[j];arr[j]=token;procs[j+1]=procs[j];procs[j]=procNew}}}function getProcedure(token){var proc=procedure[token.type];if(proc===procedure.attribute){proc=attributes[token.action];if(proc===attributes.equals&&token.name==="id"){proc=9}if(token.ignoreCase){proc>>=1}}else if(proc===procedure.pseudo){if(!token.data){proc=3}else if(token.name==="has"||token.name==="contains"){proc=0}else if(token.name==="matches"||token.name==="not"){proc=0;for(var i=0;i<token.data.length;i++){if(token.data[i].length!==1)continue;var cur=getProcedure(token.data[i][0]);if(cur===0){proc=0;break}if(cur>proc)proc=cur}if(token.data.length>1&&proc>0)proc-=1}else{proc=1}}return proc}},{"./procedure.json":6}],9:[function(require,module,exports){module.exports={trueFunc:function trueFunc(){return true},falseFunc:function falseFunc(){return false}}},{}],10:[function(require,module,exports){module.exports=compile;var BaseFuncs=require("boolbase"),trueFunc=BaseFuncs.trueFunc,falseFunc=BaseFuncs.falseFunc;function compile(parsed){var a=parsed[0],b=parsed[1]-1;if(b<0&&a<=0)return falseFunc;if(a===-1)return function(pos){return pos<=b};if(a===0)return function(pos){return pos===b};if(a===1)return b<0?trueFunc:function(pos){return pos>=b};var bMod=b%a;if(bMod<0)bMod+=a;if(a>1){return function(pos){return pos>=b&&pos%a===bMod}}a*=-1;return function(pos){return pos<=b&&pos%a===bMod}}},{boolbase:9}],11:[function(require,module,exports){var parse=require("./parse.js"),compile=require("./compile.js");module.exports=function nthCheck(formula){return compile(parse(formula))};module.exports.parse=parse;module.exports.compile=compile},{"./compile.js":10,"./parse.js":12}],12:[function(require,module,exports){module.exports=parse;var re_nthElement=/^([+\-]?\d*n)?\s*(?:([+\-]?)\s*(\d+))?$/;function parse(formula){formula=formula.trim().toLowerCase();if(formula==="even"){return[2,0]}else if(formula==="odd"){return[2,1]}else{var parsed=formula.match(re_nthElement);if(!parsed){throw new SyntaxError("n-th rule couldn't be parsed ('"+formula+"')")}var a;if(parsed[1]){a=parseInt(parsed[1],10);if(isNaN(a)){if(parsed[1].charAt(0)==="-")a=-1;else a=1}}else a=0;return[a,parsed[3]?parseInt((parsed[2]||"")+parsed[3],10):0]}}},{}]},{},[])("/lib/mark.selector.js")});
