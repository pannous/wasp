(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.MarkConvert=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({"/lib/mark.convert.js":[function(require,module,exports){var MarkConvert=function(Mark){let m=Mark;function toMark(elmt,options){if(!elmt)return null;var obj=m(options.format==="xml"?elmt.tagName:elmt.tagName.toLowerCase());if(elmt.hasAttributes()){var attrs=elmt.attributes;for(var i=0;i<attrs.length;i++){var attr=attrs[i];if(attr.specified)obj[attr.name]=attr.value}}if(elmt.hasChildNodes()){for(var i=0;i<elmt.childNodes.length;i++){var child=elmt.childNodes[i];if(child.nodeType===3){if(options.ignoreSpace&&/^\s*$/.test(child.textContent)){}else{obj.push(child.textContent)}}else if(child.nodeType===1){obj.push(toMark(child,options))}else if(child.nodeType===8){obj.push(m.pragma("!--"+child.nodeValue,obj))}}}return obj}MarkConvert.parse=function(source,options){if(!options){options={ignoreWhitespace:false}}if(typeof document!=="undefined"){var doc=document.implementation.createHTMLDocument(null);if(source.match(/^\s*(<!doctype|<html)/i)){var parser=new DOMParser;var doc=parser.parseFromString(source,"text/html");return toMark(doc.documentElement,options)}else if(source.match(/^\s*(<\?xml)/i)){var parser=new DOMParser;var doc=parser.parseFromString(source,"text/xml");return toMark(doc.documentElement,options)}else{doc.body.innerHTML=source;var children=doc.body.children;if(!children)return null;if(children.length>1){var result=[];for(var i=0;i<children.length;i++){result.push(toMark(children[i],options))}return result}else{return toMark(doc.body.children[0],options)}}}else{var htmlparser=require("htmlparser2");var parent=[],stack=[];var opt={decodeEntities:true};if(options.format=="xml"){opt.xmlMode=true}var parser=new htmlparser.Parser({onopentag:function(name,attribs){var obj=m(name,attribs,null,parent);if(parent){parent.push(obj);stack.push(parent);parent=obj}else{parent=obj}},ontext:function(text){if(options.ignoreSpace&&/^\s*$/.test(text)){}else{parent.push(text)}},oncomment:function(comment){parent.push(Mark.pragma("!--"+comment,parent))},onclosetag:function(tagname){parent=stack.pop()}},opt);parser.write(source.trim());parser.end();return parent.length==1?parent[0]:parent}};var htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"};var htmlEscaper=/[&<>"']/g;function escapeStr(str){return(""+str).replace(htmlEscaper,function(match){return htmlEscapes[match]})}MarkConvert.toHtml=function(object){var emptyTags={area:1,base:1,basefont:1,br:1,col:1,frame:1,hr:1,img:1,input:1,isindex:1,link:1,meta:1,param:1,embed:1};function htm(obj){if(typeof obj!=="object"){return""}var pragma=obj.pragma();if(pragma){return(pragma.substr(0,3)==="!--"?"<":"\x3c!--")+pragma+"--\x3e"}var buffer="<"+obj.constructor.name;for(var prop in obj){var value=obj[prop];if(value!=null&&typeof value!=="function"){buffer+=" "+prop+'="'+escapeStr(value)+'"'}}buffer+=">";for(var item of obj){if(typeof item==="string"){buffer+=escapeStr(item)}else if(typeof item==="object"){buffer+=htm(item)}else{console.log("unknown object",item)}}if(!emptyTags[obj.constructor.name]){buffer+="</"+obj.constructor.name+">"}return buffer}var html=htm(object);if(html&&object.constructor.name=="html"){return"<!DOCTYPE html>"+html}else{return html}};MarkConvert.toXml=function(object){function xml(obj){if(typeof obj!=="object"){return""}if(obj.pragma()){var pragma=obj.pragma();return pragma.startsWith("!--")?"<"+pragma+"--\x3e":"<?"+pragma+"?>"}var buffer="<"+obj.constructor.name;for(var prop in obj){var value=obj[prop];if(value!=null&&typeof value!=="function"){buffer+=" "+prop+'="'+escapeStr(value)+'"'}}if(obj[0]){buffer+=">";for(var item of obj){if(typeof item==="string"){buffer+=escapeStr(item)}else if(typeof item==="object"){buffer+=xml(item)}else{console.log("unknown object",item)}}buffer+="</"+obj.constructor.name+">"}else{buffer+="/>"}return buffer}var result=xml(object);return'<?xml version="1.0" encoding="UTF-8"?>'+result};return MarkConvert};if(typeof module==="object")module.exports=MarkConvert},{htmlparser2:"htmlparser2"}]},{},[])("/lib/mark.convert.js")});
